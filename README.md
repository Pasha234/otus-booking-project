# Booking API

Это бэкенд-приложение для системы бронирования, разработанное на Symfony. Оно позволяет пользователям создавать группы, управлять ресурсами (например, переговорными комнатами, проекторами) и бронировать эти ресурсы на определенное время, приглашая других участников.

Приложение использует CQRS-подобный подход с разделением на запись (PostgreSQL) и чтение (Redis) для повышения производительности.

## Основные технологии

*   **Бэкенд:** PHP 8.2+, Symfony 6.4+
*   **База данных:** PostgreSQL 16
*   **Кэширование / Модель чтения:** Redis
*   **API:** RESTful
*   **Контейнеризация:** Docker, Docker Compose
*   **Веб-сервер:** Nginx
*   **Фронтенд:** Webpack encore (для сборки ассетов)

## Установка и запуск

Для запуска проекта необходимо выполнить следующие шаги:

1.  **Клонировать репозиторий:**
    ```bash
    git clone <repository-url>
    cd project-directory
    ```

2.  **Настроить переменные окружения:**

    Создайте файл `.env` в директории `backend/` на основе существующего.

    ```bash
    cd backend
    # Если есть .env.example, скопируйте его:
    # cp .env.example .env
    ```

    Убедитесь, что переменные `POSTGRES_DB`, `POSTGRES_USER`, `POSTGRES_PASSWORD`, `REDIS_HOST`, `REDIS_PORT` и `DATABASE_URL` настроены корректно для вашей среды.

3.  **Собрать и запустить Docker-контейнеры:**

    Находясь в корневой директории проекта (где лежит `docker-compose.yaml`), выполните:
    ```bash
    ./docker-build-prod.sh
    ```

    Это команда установит зависимости Composer, применит миграции бд и соберет ассеты

4.  **Загрузить тестовые данные (fixtures):**

    Для наполнения базы данных большим набором данных для стресс-тестирования:
    ```bash
    docker-compose exec php php bin/console doctrine:fixtures:load --group=stress-group --no-interaction
    ```

5.  **Индексировать данные в Redis:**

    После загрузки фикстур, необходимо проиндексировать данные из основной БД в Redis для корректной работы репозитория чтения.
    ```bash
    docker-compose exec php php bin/console app:redis:index-bookings
    ```

6.  **Доступ к приложению:**
    *   **API:** `http://localhost`
    *   **Redis Insight** (для просмотра данных в Redis): `http://localhost:5540`
    *   **PostgreSQL** (для прямого подключения к БД): `localhost:5432`

## Запуск тестов

Для запуска интеграционных тестов выполните:
```bash
docker-compose exec php ./bin/phpunit
```

## Доступные консольные команды

*   `app:redis:index-bookings`: Индексирует все существующие бронирования из основной базы данных в Redis. Полезна для первоначального наполнения или ре-индексации.

### Покрытие тестами

Code Coverage Report:        
  2025-07-29 17:40:45        
                             
 Summary:                    
  Classes: 62.37% (58/93)    
  Methods: 66.46% (218/328)  
  Lines:   68.85% (1061/1541)